<div class="prescription-form-container fade-in">
  <!-- Header Section -->
  <div class="form-header">
    <div class="header-content">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="page-title">
            {{ isEdit ? 'Edit Prescription' : 'Create New Prescription' }}
          </h1>
          <p class="page-subtitle">
            {{ isEdit ? 'Update patient prescription details' : 'Add a new prescription for patient care' }}
          </p>
        </div>
        <button class="btn btn-back" routerLink="/dashboard/prescriptions">
          <fa-icon [icon]="faArrowLeft" class="me-2"></fa-icon>
          Back to List
        </button>
      </div>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-xl-10">
      <div class="form-card">
        <!-- Loading State -->
        <div *ngIf="loading && isEdit" class="loading-container">
          <div class="loading-content">
            <fa-icon [icon]="faSpinner" class="spinner-large spin"></fa-icon>
            <p class="loading-text">Loading prescription details...</p>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="alert alert-error slide-in-down">
          <div class="alert-content">
            <fa-icon [icon]="faExclamationCircle" class="alert-icon"></fa-icon>
            <div class="alert-text">
              <strong>Error</strong>
              <p>{{ errorMessage }}</p>
            </div>
            <button class="alert-close" (click)="errorMessage = ''">
              <fa-icon [icon]="faTimes"></fa-icon>
            </button>
          </div>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="alert alert-success slide-in-down">
          <div class="alert-content">
            <fa-icon [icon]="faCheckCircle" class="alert-icon"></fa-icon>
            <div class="alert-text">
              <strong>Success</strong>
              <p>{{ successMessage }}</p>
            </div>
          </div>
        </div>

        <!-- Prescription Form -->
        <form *ngIf="!loading || !isEdit" 
              (ngSubmit)="onSubmit()" 
              #prescriptionForm="ngForm"
              class="prescription-form">
          
          <!-- Dates Section -->
          <div class="form-section">
            <h3 class="section-title">
              <fa-icon [icon]="faCalendarAlt" class="me-2"></fa-icon>
              Dates
            </h3>
            <div class="row g-4">
              <!-- Prescription Date -->
              <div class="col-md-6">
                <label for="prescriptionDate" class="form-label required">
                  Prescription Date
                </label>
                <div class="input-wrapper">
                  <fa-icon [icon]="faCalendarAlt" class="input-icon"></fa-icon>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="prescriptionDate"
                    [(ngModel)]="prescription.prescriptionDate" 
                    name="prescriptionDate"
                    [min]="getMinDate()"
                    [max]="getMaxDate()"
                    [class.is-invalid]="isFieldInvalid('prescriptionDate')"
                    required>
                </div>
                <div *ngIf="isFieldInvalid('prescriptionDate')" class="invalid-feedback">
                  Prescription date is required
                </div>
              </div>

              <!-- Next Visit Date -->
              <div class="col-md-6">
                <label for="nextVisitDate" class="form-label">
                  Next Visit Date
                </label>
                <div class="input-wrapper">
                  <fa-icon [icon]="faCalendarAlt" class="input-icon"></fa-icon>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="nextVisitDate"
                    [(ngModel)]="prescription.nextVisitDate" 
                    name="nextVisitDate"
                    [min]="prescription.prescriptionDate"
                    [max]="getMaxDate()">
                </div>
                <div class="form-help">
                  Optional - Schedule patient's next visit
                </div>
              </div>
            </div>
          </div>

          <!-- Patient Information Section -->
          <div class="form-section">
            <h3 class="section-title">
              <fa-icon [icon]="faUser" class="me-2"></fa-icon>
              Patient Information
            </h3>
            <div class="row g-4">
              <!-- Patient Name -->
              <div class="col-md-6">
                <label for="patientName" class="form-label required">
                  Patient Name
                </label>
                <div class="input-wrapper">
                  <fa-icon [icon]="faUser" class="input-icon"></fa-icon>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="patientName"
                    [(ngModel)]="prescription.patientName" 
                    name="patientName"
                    placeholder="Enter patient full name"
                    [class.is-invalid]="isFieldInvalid('patientName')"
                    required>
                </div>
                <div *ngIf="isFieldInvalid('patientName')" class="invalid-feedback">
                  Patient name is required
                </div>
              </div>

              <!-- Patient Age -->
              <div class="col-md-3">
                <label for="patientAge" class="form-label required">
                  Age
                </label>
                <div class="input-wrapper">
                  <input 
                    type="number" 
                    class="form-control" 
                    id="patientAge"
                    [(ngModel)]="prescription.patientAge" 
                    name="patientAge"
                    placeholder="Years"
                    min="0"
                    max="150"
                    [class.is-invalid]="isFieldInvalid('patientAge')"
                    required>
                  <span class="input-suffix">yrs</span>
                </div>
                <div *ngIf="isFieldInvalid('patientAge')" class="invalid-feedback">
                  Valid age between 0-150 years is required
                </div>
              </div>

              <!-- Patient Gender -->
              <div class="col-md-3">
                <label for="patientGender" class="form-label required">
                  Gender
                </label>
                <div class="input-wrapper">
                  <fa-icon [icon]="faVenusMars" class="input-icon"></fa-icon>
                  <select 
                    class="form-select" 
                    id="patientGender"
                    [(ngModel)]="prescription.patientGender" 
                    name="patientGender"
                    [class.is-invalid]="isFieldInvalid('patientGender')"
                    required>
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div *ngIf="isFieldInvalid('patientGender')" class="invalid-feedback">
                  Please select patient gender
                </div>
              </div>
            </div>
          </div>

          <!-- Medical Details Section -->
          <div class="form-section">
            <h3 class="section-title">
              <fa-icon [icon]="faStethoscope" class="me-2"></fa-icon>
              Medical Details
            </h3>
            <div class="row g-4">
              <!-- Diagnosis -->
              <div class="col-12">
                <label for="diagnosis" class="form-label">
                  <fa-icon [icon]="faStethoscope" class="me-2"></fa-icon>
                  Diagnosis
                </label>
                <div class="input-wrapper">
                  <textarea 
                    class="form-control" 
                    id="diagnosis"
                    [(ngModel)]="prescription.diagnosis" 
                    name="diagnosis"
                    rows="4"
                    placeholder="Enter diagnosis details, symptoms, and observations"></textarea>
                </div>
                <div class="form-help">
                  Describe the patient's condition and findings
                </div>
              </div>

              <!-- Medicines -->
              <div class="col-12">
                <label for="medicines" class="form-label">
                  <fa-icon [icon]="faPills" class="me-2"></fa-icon>
                  Medicines & Treatment
                </label>
                <div class="input-wrapper">
                  <textarea 
                    class="form-control" 
                    id="medicines"
                    [(ngModel)]="prescription.medicines" 
                    name="medicines"
                    rows="5"
                    placeholder="Enter prescribed medicines, dosage, frequency, and duration"></textarea>
                </div>
                <div class="form-help">
                  Include medicine names, strength, dosage instructions, and treatment duration
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <div class="action-buttons">
              <button type="button" class="btn btn-cancel" (click)="onCancel()">
                <fa-icon [icon]="faTimes" class="me-2"></fa-icon>
                Cancel
              </button>
              <button 
                type="submit" 
                class="btn btn-submit"
                [disabled]="loading">
                <fa-icon [icon]="faSpinner" class="me-2 spin" *ngIf="loading"></fa-icon>
                <fa-icon [icon]="faSave" class="me-2" *ngIf="!loading"></fa-icon>
                {{ isEdit ? 'Update Prescription' : 'Create Prescription' }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>